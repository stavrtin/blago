<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Итоги</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 2100px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }

        /* Header Styles */
        .header {
            background: #2c3e50;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .header h1 {
            text-align: center;
            margin-bottom: 15px;
            font-size: 28px;
        }

        .nav-menu {
            display: flex;
            justify-content: center;
            gap: 30px;
        }

        .nav-item {
            text-decoration: none;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            background: #3498db;
            transition: background 0.3s ease;
        }

        .nav-item:hover {
            background: #2980b9;
        }

        /* Table Sections */
        .table-section {
            margin-bottom: 30px;
        }

        .table-section h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 24px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border: 1px solid #ddd;
        }

        .data-table th {
            background: #34495e;
            color: white;
            font-weight: bold;
            text-align: center;
        }

        .data-table tr:nth-child(even) {
            background: #f9f9f9;
        }

        .data-table tr:hover {
            background: #f1f1f1;
        }

        /* Блок ведомостей */
        .tables-section {
            margin-bottom: 30px;
        }

        .tables-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .table-wrapper {
            flex: 1;
            min-width: 300px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        /* Блок балансов */
        .balance-section {
            background: #ecf0f1;
            padding: 25px;
            border-radius: 8px;
        }

        .balance-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .balance-table th {
            background: #2c3e50;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .tables-container {
                flex-direction: column;
            }

            .table-wrapper {
                min-width: auto;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .nav-menu {
                flex-direction: column;
                align-items: center;
            }

            .balance-section {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
results_1.html
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>Система расчета - Итоги</h1>
            <nav class="nav-menu">
                <a href="{% url 'app_calc:tab_start_view' project.id %}" class="nav-item">Ввод данных</a>
                <a href="{% url 'app_calc:results_view'  project.id %}" class="nav-item">Итоги</a>
            </nav>
        </header>

<!-- Таблица с суммированными данными -->
<!--<div class="table-section">-->
<!--    <h2>Суммированные данные</h2>-->
<!--    <table class="data-table">-->
<!--        <thead>-->
<!--            <tr>-->
<!--                <th>№</th>-->
<!--                <th>Элемент</th>-->
<!--                <th>Характеристика</th>-->
<!--                <th>Тип работ</th>-->
<!--                <th>Суммарная площадь</th>-->
<!--                <th>Суммарная длина</th>-->
<!--            </tr>-->
<!--        </thead>-->
<!--        <tbody>-->
<!--            {% for item in input_data_total %}-->
<!--            <tr>{{item}}-->
<!--                <td>{{ forloop.counter }}</td>-->
<!--                <td>{{ item.element_id__name_element|default:"Не указано" }}</td>-->
<!--                <td>{{ item.property_id__property_name|default:"Не указано" }}</td>-->
<!--                <td>{{ item.event|default:"Не указано" }}</td>-->
<!--                <td>{{ item.total_square|floatformat:2 }}</td>-->
<!--                <td>{{ item.total_length|default:""}}</td>-->
<!--            </tr>-->
<!--            {% empty %}-->
<!--            <tr>-->
<!--                <td colspan="6" style="text-align: center;">Нет данных для суммирования</td>-->
<!--            </tr>-->
<!--            {% endfor %}-->
<!--        </tbody>-->
<!--    </table>-->
<!--</div>-->

<!-- Таблица с детальными данными (оригинальная) -->
<!--<div class="table-section">-->
<!--    <h2>Детальные данные</h2>-->
<!--    <table class="data-table">-->
<!--        <thead>-->
<!--            <tr>-->
<!--                <th>№</th>-->
<!--                <th>Объект</th>-->
<!--                <th>Характеристика</th>-->
<!--                <th>Площадь</th>-->
<!--                <th>Длина</th>-->
<!--                <th>Тип работ</th>-->
<!--            </tr>-->
<!--        </thead>-->
<!--        <tbody>-->
<!--            {% for item in input_data %}-->
<!--            <tr>-->
<!--                <td>{{ forloop.counter }}</td>-->
<!--                <td>{{ item.object_type.name|default:"" }}</td>-->
<!--                <td>{{ item.property.property_name|default:"" }}</td>-->
<!--                <td>{{ item.square|default:"" }}</td>-->
<!--                <td>{{ item.length|default:"" }}</td>-->
<!--                <td>{{ item.event|default:"" }}</td>-->
<!--            </tr>-->
<!--            {% empty %}-->
<!--            <tr>-->
<!--                <td colspan="6" style="text-align: center;">Нет данных</td>-->
<!--            </tr>-->
<!--            {% endfor %}-->
<!--        </tbody>-->
<!--    </table>-->
<!--</div>-->

        <!-- Блок 2: Ведомости -->
        <div class="tables-section">
            <h2>Ведомости</h2>

            <div class="tables-container">
                <!-- Ведомость демонтажа -->
                <div class="table-wrapper">
                    <h3>Ведомость демонтажа</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>№</th>
<!--                                <th>Элемент</th>-->
                                <th>Наименование</th>
                                <th>Площадь</th>
                                <th>Примечание</th>
                            </tr>
                        </thead>

                        <tbody>
                            {% for item in demontaj_total %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
<!--                                <td>{{ item.element_id__name_element }}</td>-->
                                <td> <b> {{item.element_id__name_element }} </b>- {{ item.property_id__property_name }}</td>
                                <td>{{ item.total_square }}</td>
                                <td>{{ item.event }}</td>
                            </tr>
                            {% empty %}
                            {% for i in "123" %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            {% endfor %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <!-- Ведомость тротуаров -->
                <div class="table-wrapper">
                    <h3>Ведомость тротуаров</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>№</th>
                                <th>Условное обозн.</th>
                                <th>Наименование</th>
<!--                                <th>Тип покрытия</th>-->
                                <th>Площадь, кв.м</th>
                                <th>Примечание</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in trotuar_dorojki_total %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td></td>
                                <td> <b> {{item.element_id__name_element }}</b> - {{item.property_id__property_name }}</td>
                                <td>{{ item.total_square }}</td>
                                <td>{{ item.event }}</td>
                            </tr>
                            {% empty %}
                            {% for i in "123456" %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            {% endfor %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <!-- Ведомость газонов -->
                <div class="table-wrapper">
                    <h3>Ведомость газонов / травяного покрова</h3>

                    <!------------------------------ таблица ГАЗОНОВ н-------------------------->
<!--<table class="data-table">-->
<!--    <thead>-->
<!--        <tr>-->
<!--            <th>№</th>-->
<!--            <th>Наименование</th>-->
<!--            <th>Площадь</th>-->
<!--        </tr>-->
<!--    </thead>-->
<!--    <tbody>-->
<!--        {% regroup total_zelenl by property_id__property_name as properties_list %}-->

<!--        {% for property in properties_list %}-->
<!--        &lt;!&ndash; Основная строка с названием характеристики &ndash;&gt;-->
<!--        <tr style="background-color: #f0f0f0;">-->
<!--            <td><b>{{ forloop.counter }}</b></td>-->
<!--            <td><b>{{ property.grouper }}</b></td>-->
<!--            <td></td>-->
<!--        </tr>-->

<!--        &lt;!&ndash; Подстроки с событиями для этой характеристики &ndash;&gt;-->
<!--        {% for item in property.list %}-->
<!--        <tr>-->
<!--            <td style="padding-left: 30px;">{{ forloop.parentloop.counter }}.{{ forloop.counter }}</td>-->
<!--            <td style="padding-left: 30px;">-->
<!--                {% if item.event == 'destroy' %}уничтожение-->
<!--                {% elif item.event == 'ustroy' %}устройство-->
<!--                {% elif item.event == 'sohran' %}сохранение-->
<!--                {% elif item.event == 'vosstan' %}восстановление-->
<!--                {% else %}{{ item.event }}-->
<!--                {% endif %}-->
<!--            </td>-->
<!--            <td>{{ item.total_square }}</td>-->
<!--        </tr>-->
<!--        {% endfor %}-->
<!--        {% empty %}-->
<!--        <tr>-->
<!--            <td colspan="3" style="text-align: center;">Нет данных по озеленению</td>-->
<!--        </tr>-->
<!--        {% endfor %}-->
<!--    </tbody>-->
<!--</table>-->
<!------------------------------ таблица ГАЗОНОВ 2 н-------------------------->

<table name="gaz" class="data-table" border="1" cellspacing="0" cellpadding="5">
    <thead>
        <tr>
            <th>№</th>
            <th>Наименование</th>
            <th>Площадь</th>
            <th>Сумма (устр+сохр+восст)</th>
        </tr>
    </thead>
    {{total_zelenl}}
    calcilate_zelen_summ {{calcilate_zelen_summ}}
    <tbody>
        {% regroup total_zelenl by property_id__property_name as properties_list %}

        {% for property in properties_list %}
        <!-- Основная строка с названием характеристики -->
        <tr style="background-color: #f0f0f0;">
            <td><b>{{ forloop.counter }}</b></td>
            <td><b>{{ property.grouper }}</b></td>
            <td>{{calcilate_zelen_summ}}----</td>
            <td></td>
        </tr>

        <!-- Вычисляем сумму простым способом -->
        {% with sum=0 %}
            {% for item in property.list %}
                {% if item.event == 'ustroy' %}
                    {% with sum=sum|add:item.total_square %}{% endwith %}
                {% endif %}
                {% if item.event == 'sohran' %}
                    {% with sum=sum|add:item.total_square %}{% endwith %}
                {% endif %}
                {% if item.event == 'vosstan' %}
                    {% with sum=sum|add:item.total_square %}{% endwith %}
                {% endif %}
            {% endfor %}

            <!-- Сохраняем сумму в переменную -->
            {% with total_sum=sum %}{% endwith %}
        {% endwith %}

        <!-- Подстроки с событиями -->
        {% for item in property.list %}
        <tr>
            <td style="padding-left: 30px;">{{ forloop.parentloop.counter }}.{{ forloop.counter }}</td>
            <td style="padding-left: 30px;">
                {% if item.event == 'destroy' %}уничтожение
                {% elif item.event == 'ustroy' %}устройство
                {% elif item.event == 'sohran' %}сохранение
                {% elif item.event == 'vosstan' %}восстановление
                {% else %}{{ item.event }}
                {% endif %}
            </td>
            <td>{{ item.total_square }}</td>

            <!-- Ячейка с суммой - отображаем только для первой строки -->
            {% if forloop.first %}
                <td rowspan="{{ property.list|length }}" style="background-color: #e8f5e8; text-align: center; vertical-align: middle;">
                    <b>{{ total_sum }}</b>sum
                </td>
            {% endif %}
        </tr>
        {% endfor %}
        {% empty %}
        <tr>
            <td colspan="4" style="text-align: center;">Нет данных по озеленению</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<!------------------------------ таблица ГАЗОНОВ к-------------------------->
                </div>
            </div>
        </div>

        <!-- Блок 3: Балансы старые -->
        <div class="balance-section">
            <h2>Балансы</h2>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>№</th>
                        <th>Характеристика</th>
                        <th>Существующее положение (м2)</th>
                        <th>Существующее положение %</th>
                        <th>Проектные решения (м2)</th>
                        <th>Проектные решения (%)</th>

                    </tr>
                </thead>


<tbody>
    <!-- Первая строка - Общая площадь -->
    <tr>
        <td>1</td>
        <td>Общая площадь</td>
        <td>{{ total_area.existing|default:"" }}</td>
        <td>{{ total_area.existing_percent|default:"" }}</td>
        <td>{{ total_area.project|default:"" }}</td>
        <td>{{ total_area.project_percent|default:"" }}</td>
    </tr>

    <!-- Вторая строка - Площадь зданий и сооружений -->
    <tr>
        <td>2</td>
        <td>Площадь зданий и сооружений</td>
        <td>{{ building_area.existing|default:"" }}</td>
        <td>{{ building_area.existing_percent|default:"" }}</td>
        <td>{{ building_area.project|default:"" }}</td>
        <td>{{ building_area.project_percent|default:"" }}</td>
    </tr>

    <!-- Третья строка - Площадь дорожных покрытий -->
    <tr>
        <td>3</td>
        <td>Площадь дорожных покрытий, в том числе...</td>
        <td>{{ road_area.existing|default:"" }}</td>
        <td>{{ road_area.existing_percent|default:"" }}</td>
        <td>{{ road_area.project|default:"" }}</td>
        <td>{{ road_area.project_percent|default:"" }}</td>
    </tr>
        <td>4</td>
        <td>Площадь озеленения, в том числе... </td>
        <td>{{ road_area.existing|default:"" }}</td>
        <td>{{ road_area.existing_percent|default:"" }}</td>
        <td>{{ road_area.project|default:"" }}</td>
        <td>{{ road_area.project_percent|default:"" }}</td>
    </tr>
    <!-- Остальные строки через цикл -->
    {% for item in other_balance_data %}
    <tr>
        <td>{{ forloop.counter|add:3 }}</td>
        <td>{{ item.name|default:"" }}</td>
        <td>{{ item.existing_area|default:"" }}</td>
        <td>{{ item.existing_percent|default:"" }}</td>
        <td>{{ item.project_area|default:"" }}</td>
        <td>{{ item.project_percent|default:"" }}</td>
    </tr>
    {% endfor %}
</tbody>


            </table>
        </div>
    </div>
</body>
</html>